name: CI/CD Pipeline

on:
  push:
    branches: [main, test-deploy]
  pull_request:
    branches: [main]
  workflow_dispatch: # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 9:00 UTC (–∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç)
    - cron: '0 9 * * 1'

jobs:
  validate-and-test:
    name: "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –∏ —Ç–µ—Å—Ç—ã"
    runs-on: ubuntu-latest
    
    steps:
      # 1. –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥
      - name: Checkout repository
        uses: actions/checkout@v4
        
      # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      - name: Install dependencies
        run: npm install
        
      # 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –ª–∏–Ω—Ç–µ—Ä–æ–º (–∫—Ä–∏—Ç–µ—Ä–∏–π: –ø—Ä–æ–≤–µ—Ä–∫–∞ PEP8/–∞–Ω–∞–ª–æ–≥)
      - name: Run ESLint
        run: npm run lint
        
      # 5. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã (–∫—Ä–∏—Ç–µ—Ä–∏–π: unit tests)
      - name: Run tests
        run: npm test
        
      # 6. –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)
      - name: Build verification
        run: |
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤..."
          ls -la
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º HTML..."
          if [ -f "index.html" ]; then echo "‚úì index.html –Ω–∞–π–¥–µ–Ω"; else exit 1; fi

  deploy:
    name: "üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π"
    runs-on: ubuntu-latest
    needs: validate-and-test # –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π job —É—Å–ø–µ—à–µ–Ω
    if: github.ref == 'refs/heads/main' # –î–µ–ø–ª–æ–∏–º —Ç–æ–ª—å–∫–æ –∏–∑ main
    
    steps:
      # 1. –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥
      - name: Checkout repository
        uses: actions/checkout@v4
        
      # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      - name: Install dependencies
        run: npm install
        
      # 4. –î–µ–ø–ª–æ–π –Ω–∞ GitHub Pages (–∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç)
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages # –í–µ—Ç–∫–∞ –¥–ª—è GitHub Pages
          folder: . # –ü–∞–ø–∫–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –¥–ª—è –¥–µ–ø–ª–æ—è (–≤—Å—ë –∏–∑ –∫–æ—Ä–Ω—è)
          
      # 5. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –¥–µ–ø–ª–æ–µ (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç)
      - name: Deployment success notice
        run: |
          echo "‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!"
          echo "–°–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: https://pepega-commander.github.io/gitverse-custom-card-site/"
        if: success()

  weekly-report:
    name: "üìä –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç"
    runs-on: ubuntu-latest
    if: always() # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ jobs —É–ø–∞–ª–∏
    
    steps:
      # 1. –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥
      - name: Checkout repository
        uses: actions/checkout@v4
        
      # 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –æ—Ç—á–µ—Ç (–∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç)
      - name: Generate weekly report
        run: |
          echo "üìà –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞: ${{ github.repository }}" > report.md
          echo "–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: $(date)" >> report.md
          echo "---" >> report.md
          echo "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤: $(find . -type f | wc -l)" >> report.md
          echo "–†–∞–∑–º–µ—Ä —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: $(du -sh . | cut -f1)" >> report.md
          echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã:" >> report.md
          git log --oneline -5 >> report.md
          
      # 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á–µ—Ç –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç (–º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Å–∫–∞—á–∞—Ç—å)
      - name: Upload report as artifact
        uses: actions/upload-artifact@v4
        with:
          name: weekly-report
          path: report.md
          retention-days: 7
